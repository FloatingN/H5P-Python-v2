!function(){"use strict";function t(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,i,r,s,u=[],a=!0,p=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=r.call(n)).done)&&(u.push(o.value),u.length!==e);a=!0);}catch(t){p=!0,i=t}finally{try{if(!a&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(p)throw i}}return u}}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return e(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var n=function(){function e(t){this.python=t,this.params=t.params,this.setupApi(),this.content=document.createElement("div"),this.content.classList.add("h5p-python-content"),this.content.style.maxHeight=this.params.editorOptions.maxHeight,this.createInstructions(),this.createEditor(),this.createOutput(),this.addButtons(),window.editor=this.editor,window.output=this.output,window.tutu=this}var n=e.prototype;return n.run=function(){var t=this;this.shouldStop=!1,this.setupApi={},this.python.hideButton("run"),this.python.showButton("stop"),this.editor.setOption("readOnly",!0),this.output.setValue(""),Sk.H5P.run(this.getCodeToRun(this.editor.getValue()),{output:function(e){CodeMirror.H5P.appendText(t.output,e)},input:function(e,n,o){t.currentRejectPromise=o,e.output(e.prompt);var i=t.output.lastLine(),r=t.output.getLine(i).length;t.output.setOption("readOnly",!1);var s=t.output.markText({line:0,ch:0},{line:i,ch:r},{readOnly:!0}),u=function(){t.output.execCommand("goDocEnd")},a=function(){var e=t.output.getCursor("head"),n=t.output.getCursor("anchor");(e.line<i||e.line===i&&e.ch<r)&&(e={line:i,ch:r}),(n.line<i||n.line===i&&n.ch<r)&&(n={line:i,ch:r}),t.output.setSelection(n,e)};t.output.on("focus",u),t.output.on("cursorActivity",a),t.output.focus(),t.output.addKeyMap({name:"sendInput",Enter:function(){var o=t.output.lastLine(),p=t.output.getLine(o).length;e.output("\n"),t.output.off("focus",u),t.output.off("cursorActivity",a),t.output.removeKeyMap("sendInput"),s.clear(),t.output.setOption("readOnly",!0),t.output.getInputField().blur(),n(t.output.getRange({line:i,ch:r},{line:o,ch:p}))}})},onSuccess:function(){t.params.requireRunBeforeCheck&&t.python.showButton("check-answer")},onError:function(e){var n;if(t.shouldStop)n="Execution interrupted";else{if(e.traceback){var o=t.getBeforeCode().split("\n").length-1;e.traceback.forEach((function(t){"<stdin>.py"===t.filename&&(t.lineno-=o)}))}n=e.toString(),e.traceback&&e.traceback.length>1&&(n+=Sk.H5P.getTraceBackFromError(e))}CodeMirror.H5P.appendLines(t.output,n,"CodeMirror-python-highlighted-error-line")},onFinally:function(){t.python.showButton("run"),t.python.hideButton("stop"),t.editor.setOption("readOnly",!1)},shouldStop:function(){return t.shouldStop}})},n.stop=function(){this.editor.setOption("readOnly",!1),this.shouldStop=!0,void 0!==this.currentRejectPromise&&this.currentRejectPromise("Interrupted execution"),void 0!==Sk.rejectSleep&&Sk.rejectSleep("Interrupted execution")},n.checkAnswer=function(){this.stop(),this.shouldStop=!1,this.setupApi={},this.python.hideButton("run"),this.python.showButton("stop"),this.editor.setOption("readOnly",!0),this.python.hideButton("check-answer"),this.params.behaviour.enableSolutionsButton&&this.params.solutionCode&&this.python.showButton("show-solution"),this.params.behaviour.enableRetry&&this.python.showButton("try-again"),"compareOutputs"===this.params.grading.gradingMethod&&this.checkAnswer_compareOutputs(),"programmedGrading"===this.params.grading.gradingMethod&&this.checkAnswer_programmedGrading()},n.checkAnswer_compareOutputs=function(){var t,e,n=this,o=-1,i=!1;this.output.setValue("");var r=Promise.resolve();this.params.grading.inputs.map((function(){return function(){return o++,e=n.params.grading.inputs[o].split("\n"),t=0,n.userOutput="",n.solOutput="",Sk.H5P.run(n.getCodeToRun(n.editor.getValue(),!0),{output:function(t){n.userOutput+=t},input:function(n,o){var i=e[t]||"";t++,n.output(n.prompt),n.output(i),n.output("\n"),o(i)},chain:!0,shouldStop:function(){return n.shouldStop}}).catch((function(t){i=t})).then((function(){return t=0,Sk.H5P.run(n.getCodeToRun(CodeMirror.H5P.decode(n.params.solutionCode),!0),{output:function(t){n.solOutput+=t},input:function(n,o){var i=e[t]||"";t++,n.output(n.prompt),n.output(i),n.output("\n"),o(i)},shouldStop:function(){return n.shouldStop}})})).finally((function(){if(i||n.userOutput!==n.solOutput){var t="";if(i){if(i.traceback){var e=n.getBeforeCode(!0).split("\n").length-1;i.traceback.forEach((function(t){"<stdin>.py"===t.filename&&(t.lineno-=e)}))}t+="Error while execution\n",t+="----------------\n",t+=i.toString()}else t+="Output Missmatch\n",t+="----------------\n",t+="Expected output :\n",t+="----------------\n",t+=n.solOutput,t+="----------------\n",t+="Current output :\n",t+="----------------\n",t+=n.userOutput;return CodeMirror.H5P.appendLines(n.output,t,"CodeMirror-python-highlighted-error-line"),Promise.reject()}return Promise.resolve()}))}})).forEach((function(t){r=r.then(t)})),r.then((function(){n.python.setFeedback(void 0,n.params.grading.maxScore,n.params.grading.maxScore),n.python.answerGiven=!0,n.python.score=n.params.maxScore,n.python.passed=!0})).catch((function(){n.python.setFeedback(void 0,0,n.params.grading.maxScore),n.python.answerGiven=!0,n.python.score=0,n.python.passed=!1})).finally((function(){n.python.hideButton("stop")}))},n.checkAnswer_programmedGrading=function(){var t,e,n=this,o=-1,i=!1;this.output.setValue("");var r=Promise.resolve();this.params.grading.inputs.map((function(){return function(){return o++,e=n.params.grading.inputs[o].split("\n"),t=0,n.userOutput="",n.solOutput="",Sk.H5P.run(n.getCodeToRun(n.editor.getValue(),!0,{execution:o}),{output:function(t){n.userOutput+=t},input:function(n,o){var i=e[t]||"";t++,n.output(n.prompt),n.output(i),n.output("\n"),o(i)},chain:!0,shouldStop:function(){return n.shouldStop}}).catch((function(t){i=t})).finally((function(){if(i){var t="";if(i.traceback){var e=n.getBeforeCode(!0).split("\n").length-1;i.traceback.forEach((function(t){"<stdin>.py"===t.filename&&(t.lineno-=e)}))}return t+="Error while execution\n",t+="----------------\n",t+=i.toString(),CodeMirror.H5P.appendLines(n.output,t,"CodeMirror-python-highlighted-error-line"),Promise.reject()}return Promise.resolve()}))}})).forEach((function(t){r=r.then(t)})),r.catch((function(){})).finally((function(){n.python.hideButton("stop")}))},n.showSolution=function(){this.codeBeforeSolution=this.editor.getValue(),this.editor.setValue(CodeMirror.H5P.decode(this.params.solutionCode)),this.python.hideButton("show-solution"),this.python.showButton("hide-solution")},n.hideSolution=function(){this.editor.setValue(this.codeBeforeSolution),this.python.hideButton("hide-solution"),this.python.showButton("show-solution")},n.createInstructions=function(){var t=this;""!==this.params.instructions&&(this.instructions=document.createElement("div"),this.instructions.classList.add("h5p-python-instructions"),CodeMirror.requireMode("python",(function(){t.instructions.innerHTML=t.params.instructions.replace(/`(?:([^`<]+)|``([^`]+)``)`/g,(function(t,e,n){var o;if(e)o=CodeMirror.H5P.decode(e);else{var i=n.indexOf("</div>")+"</div>".length,r=n.lastIndexOf("<div>")-"<div>".length-1;if(-1===i||-1===r)return t;o=n.substr(i,r).trim(),o=(new DOMParser).parseFromString(o,"text/html").documentElement.textContent}var s=document.createElement("pre");return s.classList.add("cm-s-default"),e&&s.classList.add("h5p-python-instructions-inlineCode"),CodeMirror.runMode(o,"python",s),s.outerHTML}))}),{path:function(t){return CodeMirror.H5P.getPath("mode/"+t+"/"+t+".js")}}),this.content.appendChild(this.instructions))},n.createEditor=function(){var t=this;this.nodeEditor=document.createElement("div"),this.nodeEditor.classList.add("h5p-python-codeEditor"),this.content.appendChild(this.nodeEditor);var e=document.createElement("div");e.classList.add("h5p-python-instructions-handle"),this.nodeEditor.appendChild(e),e.addEventListener("click",(function(){t.instructions.classList.contains("hidden")?(t.instructions.classList.remove("hidden"),e.classList.remove("hidden")):(t.instructions.classList.add("hidden"),e.classList.add("hidden"))})),this.editor=CodeMirror(this.nodeEditor,{value:CodeMirror.H5P.decode(this.params.startingCode||""),inputStyle:"textarea",keyMap:"sublime",tabSize:this.params.editorOptions.tabSize,lineWrapping:!0,indentWithTabs:!0,lineNumbers:!0,matchBrackets:!0,matchTags:!!this.params.editorOptions.matchTags&&{bothTags:!0},foldGutter:this.params.editorOptions.foldGutter,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],styleActiveLine:{nonEmpty:!0},extraKeys:{F11:function(t){t.setOption("fullScreen",!t.getOption("fullScreen"))},Esc:function(t){t.getOption("fullScreen")?t.setOption("fullScreen",!1):t.state.keyMaps.some((function(t){return"tabAccessibility"===t.name}))||t.addKeyMap({name:"tabAccessibility",Tab:!1,"Shift-Tab":!1})},"Ctrl-Enter":function(){t.run()}}}),this.editor.on("focus",(function(t){t.removeKeyMap("tabAccessibility")})),this.editor.on("refresh",(function(){t.python.trigger("resize")})),""!==this.params.editorOptions.highlightLines&&CodeMirror.H5P.highlightLines(this.editor,this.params.editorOptions.highlightLines),""!==this.params.editorOptions.readOnlyLines&&CodeMirror.H5P.readOnlyLines(this.editor,this.params.editorOptions.readOnlyLines,this.params.editorOptions.readOnlyStyle?"CodeMirror-python-readonly":void 0),this.params.requireRunBeforeCheck&&this.editor.on("changes",(function(){t.python.hideButton("check-answer")})),this.editor.on("changes",(function(){t.python.trigger("resize")})),this.editor.refresh(),CodeMirror.H5P.setLanguage(this.editor,"python");var n=document.createElement("div");n.classList.add("h5p-python-output-handle"),this.nodeEditor.appendChild(n),n.addEventListener("click",(function(){t.nodeOutput.classList.contains("hidden")?(t.nodeOutput.classList.remove("hidden"),n.classList.remove("hidden")):(t.nodeOutput.classList.add("hidden"),n.classList.add("hidden"))}))},n.createOutput=function(){var t=this;this.nodeOutput=document.createElement("div"),this.nodeOutput.classList.add("h5p-python-output"),this.content.appendChild(this.nodeOutput),CodeMirror.H5P.loadTheme("nord"),this.output=CodeMirror(this.nodeOutput,{value:"",inputStyle:"textarea",theme:"nord",readOnly:!0,tabSize:2,indentWithTabs:!0,lineWrapping:!0,styleActiveLine:!1,extraKeys:{F11:function(t){t.setOption("fullScreen",!t.getOption("fullScreen"))},Esc:function(t){t.getOption("fullScreen")&&t.setOption("fullScreen",!1)},Tab:!1,"Shift-Tab":!1}}),this.output.on("focus",(function(){t.output.setOption("styleActiveLine",{nonEmpty:!0})})),this.output.on("blur",(function(){t.output.setOption("styleActiveLine",!1)})),this.output.on("refresh",(function(){t.python.trigger("resize")})),this.output.on("changes",(function(){t.python.trigger("resize")})),this.output.refresh()},n.getCodeToRun=function(t,e,n){return n=n||{},this.getBeforeCode(e,n)+t+"\n"+this.getAfterCode(e,n)},n.getBeforeCode=function(t,e){var n="";return void 0!==(e=e||{}).execution&&(n+="h5p_execution = "+e.execution+"\n",n+="h5p_lastExecution = "+(e.execution===this.params.grading.inputs.length-1?"True":"False")+"\n"),"programmedGrading"===this.params.grading.gradingMethod&&this.params.grading.executeBeforeGradingCode&&!0===t&&(n+=CodeMirror.H5P.decode(this.params.grading.executeBeforeGradingCode)+"\n"),this.params.advancedOptions.executeBeforeCode&&(n+=CodeMirror.H5P.decode(this.params.advancedOptions.executeBeforeCode||"")+"\n"),this.injectApi(n)},n.getAfterCode=function(t,e){var n="";return e=e||{},this.params.advancedOptions.executeAfterCode&&(n+=CodeMirror.H5P.decode(this.params.advancedOptions.executeBeforeCode||"")+"\n"),"programmedGrading"===this.params.grading.gradingMethod&&!0===t&&(void 0!==e.execution&&(n+="h5p_execution = "+e.execution+"\n",n+="h5p_lastExecution = "+(e.execution===this.params.grading.inputs.length-1?"True":"False")+"\n"),n+=CodeMirror.H5P.decode(this.params.grading.gradingCode||"")),this.injectApi(n)},n.setupApi=function(){var e=this;this.randomApiKey=parseInt(58786559*Math.random()+1679616).toString(36),this.apis={setScore:function(t,n,o){t=Sk.ffi.remapToJs(t),n=Sk.ffi.remapToJs(n),o=Sk.ffi.remapToJs(o),"number"==typeof t&&(void 0!==n&&"boolean"!=typeof n||void 0!==o&&"string"!=typeof o||(e.python.passed="boolean"==typeof n?n:t===e.python.maxScore,void 0!==o&&(o=H5P.jQuery("div").text(o).html()),e.python.setFeedback(o,t,e.params.maxScore)))},getOutput:function(){return Sk.ffi.remapToPy(e.userOutput)},output:function(t,n){if(t=Sk.ffi.remapToJs(t),n=Sk.ffi.remapToJs(n),"string"==typeof t&&(void 0===n||"string"==typeof n)){var o={error:"CodeMirror-python-highlighted-error-line",red:"CodeMirror-python-highlighted-error-line",success:"CodeMirror-python-highlighted-success-line",green:"CodeMirror-python-highlighted-success-line",info:"CodeMirror-python-highlighted-info-line",blue:"CodeMirror-python-highlighted-info-line",alert:"CodeMirror-python-highlighted-alert-line",yellow:"CodeMirror-python-highlighted-alert-line",note:"CodeMirror-python-highlighted-note-line",white:"CodeMirror-python-highlighted-note-line",cyan:"CodeMirror-python-highlighted-cyan-line",purple:"CodeMirror-python-highlighted-purple-line"};n=o.hasOwnProperty(n)?o[n]:void 0,CodeMirror.H5P.appendLines(e.output,t,n)}},setData:function(t,n){t=Sk.ffi.remapToJs(t),n=Sk.ffi.remapToJs(n),"string"==typeof t&&("number"!=typeof n&&"string"!=typeof n||(e.apiData[t]=n))},getData:function(t){return Sk.ffi.remapToPy(e.apiData[t])},trigger:function(t,n){if(t=Sk.ffi.remapToJs(t),n=Sk.ffi.remapToJs(n),void 0===t||"string"==typeof t){var o={context:"h5p",action:t=void 0!==t?"H5P.Python."+t:"H5P.Python",value:n};void 0!==e.triggerMode&&1!==e.triggerMode||window.parent.postMessage(o,"*"),2===e.triggerMode&&window.parent.parent.postMessage(o,"*")}},triggerMode:function(t){"number"==typeof(t=Sk.ffi.remapToJs(t))&&(e.triggerMode=t)},query:function(t,n){if(void 0===Sk.ffi.remapToJs(t)||"string"==typeof Sk.ffi.remapToJs(t))return new Sk.misceval.promiseToSuspension(new Promise((function(o,i){e.currentRejectPromise=i;window.addEventListener("message",(function t(e){e.data&&"h5p"===e.data.context&&"H5P.Python.query"===e.data.action&&(window.removeEventListener("message",t),o(e.data.value))})),e.apis.trigger(t,n)})).then((function(t){return Sk.ffi.remapToPy(t)})))}},Object.entries(this.apis).forEach((function(n){var o=t(n,2),i=o[0],r=o[1];Sk.builtins["h5p_"+i+"_"+e.randomApiKey]=r}))},n.injectApi=function(t){var e=this,n="def h5p_loader() :\n",o="";return Object.keys(this.apis).forEach((function(t){o+="h5p_"+t+" = h5p_"+t+"_"+e.randomApiKey+"\n"})),n+=o=(o+=t).split("\n").map((function(t){return"\t"+t})).join("\n")+"\n",n+="h5p_loader()\n",n+="del h5p_loader\n"},n.addButtons=function(){var t=this;this.python.addButton("run",this.params.l10n.run,(function(){t.run()})),this.python.addButton("stop",this.params.l10n.stop,(function(){t.stop()}),!1),this.python.addButton("check-answer",this.params.l10n.checkAnswer,(function(){t.checkAnswer()}),!this.params.requireRunBeforeCheck,{},{}),this.python.addButton("show-solution",this.params.l10n.showSolution,(function(){t.showSolution()}),!1,{},{}),this.python.addButton("hide-solution",this.params.l10n.hideSolution,(function(){t.hideSolution()}),!1,{},{}),this.python.addButton("try-again",this.params.l10n.tryAgain,(function(){t.python.removeFeedback(),t.editor.setOption("readOnly",!1),t.python.showButton("run"),t.python.showButton("check-answer"),t.python.hideButton("show-solution"),t.python.hideButton("try-again"),t.python.trigger("resize")}),!1,{},{}),this.python.addButton("reset",this.params.l10n.reset,(function(){t.python.resetTask()}),!0,{},{confirmationDialog:{enable:!0,instance:this.python,l10n:{}}})},n.getDOM=function(){return this.content},e}();function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}var s=function(t){var e,s;function u(e,r){var s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function p(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&("object"===o(arguments[0][e])&&"object"===o(arguments[t][e])?p(arguments[0][e],arguments[t][e]):arguments[0][e]=arguments[t][e]);return arguments[0]}return(s=t.call(this,"python")||this).params=e,s.contentId=r,s.extras=a,s.params=p({editorOptions:{readOnlyLines:""},behaviour:{enableSolutionsButton:!0,enableRetry:!0},l10n:{checkAnswer:"Check answer",showSolution:"Show solution",tryAgain:"Retry"}},s.params),s.previousState=s.extras.previousState||{},s.answerGiven=!1,s.score=0,s.maxScore=1,s.passed=!1,s.registerDomElements=function(){s.content=new n(i(s),s.previousState.random),s.setContent(s.content.getDOM()),window.toto=i(s),s.addButtons(),s.trigger("resize")},s.addButtons=function(){},s.getAnswerGiven=function(){return s.answerGiven},s.getScore=function(){return s.score},s.getMaxScore=function(){return s.maxScore},s.showSolutions=function(){s.trigger("resize")},s.resetTask=function(){s.removeFeedback(),s.content.stop(),s.showButton("run"),s.showButton("stop"),s.showButton("check-answer"),s.hideButton("show-solution"),s.hideButton("try-again"),s.content.editor.setValue(CodeMirror.H5P.decode(s.params.startingCode||"")),s.content.editor.setOption("readOnly",!1),s.content.output.setValue(""),setTimeout((function(){s.content.output.setValue("")}),0),s.trigger("resize")},s.getXAPIData=function(){return{statement:s.getXAPIAnswerEvent().data.statement}},s.getXAPIAnswerEvent=function(){var t=s.createXAPIEvent("answered");return t.setScoredResult(s.getScore(),s.getMaxScore(),i(s),!0,s.isPassed()),t},s.createXAPIEvent=function(t){var e=s.createXAPIEventTemplate(t);return p(e.getVerifiedStatementValue(["object","definition"]),s.getxAPIDefinition()),e},s.getxAPIDefinition=function(){var t={};return t.name={"en-US":s.getTitle()},t.description={"en-US":s.getDescription()},t.type="http://adlnet.gov/expapi/activities/cmi.interaction",t.interactionType="other",t},s.isPassed=function(){return s.passed},s.getTitle=function(){var t;return s.extras.metadata&&(t=s.extras.metadata.title),t=t||u.DEFAULT_DESCRIPTION,H5P.createTitle(t)},s.getDescription=function(){return s.params.taskDescription||u.DEFAULT_DESCRIPTION},s.getCurrentState=function(){return{random:Math.random(100)}},s}return s=t,(e=u).prototype=Object.create(s.prototype),e.prototype.constructor=e,r(e,s),u}(H5P.Question);s.DEFAULT_DESCRIPTION="Python",H5P=H5P||{},H5P.Python=s}();