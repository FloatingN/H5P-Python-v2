(()=>{var e={734:(e,t,n)=>{"use strict";var r,i,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){return"object"===("undefined"==typeof window?"undefined":a(window))},o=s()?window:n.g,c=!!s()&&document.attachEvent,d=!1,l=null,h=null,p=null,u=null,b=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,r=t.lastElementChild,i=n.firstElementChild;r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight,i.style.width=n.offsetWidth+1+"px",i.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},y=(r=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||function(e){return setTimeout(e,20)},function(e){return r(e)}),g=(i=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.clearTimeout,function(e){return i(e)}),m=function(e){var t=this;b(this),this.__resizeRAF__&&g(this.__resizeRAF__),this.__resizeRAF__=y((function(){(function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height})(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))};if(s()&&!c){var v=!1,f="";u="animationstart";var S="Webkit Moz O ms".split(" "),L="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),x=document.createElement("fakeelement");if(void 0!==x.style.animationName&&(v=!0),!1===v)for(var B=0;B<S.length;B++)if(void 0!==x.style[S[B]+"AnimationName"]){f="-"+S[B].toLowerCase()+"-",u=L[B],v=!0;break}h="@"+f+"keyframes "+(l="resizeanim")+" { from { opacity: 0; } to { opacity: 0; } } ",p=f+"animation: 1ms "+l+"; "}t.kp=function(e,t){c?e.attachEvent("onresize",t):s()&&(e.__resizeTriggers__||("static"==getComputedStyle(e).position&&(e.style.position="relative"),function(){if(!d){var e=(h||"")+".resize-triggers { "+(p||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n),d=!0}}(),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=document.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),b(e),e.addEventListener("scroll",m,!0),u&&e.__resizeTriggers__.addEventListener(u,(function(t){t.animationName==l&&b(e)}))),e.__resizeListeners__.push(t))}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),H5P=H5P||{},H5P.BranchingPython=function(e,t){const n=this;H5P.EventDispatcher.call(n),n.contentId=t,n.startScreen={},n.libraryScreen={},n.endScreens={},n.navigating,n.currentHeight,n.currentId=-1,n.xAPIDataCollector=[],n.userPath=[],n.backwardsAllowedFlags=[],n.proceedButtonInProgress=!1,n.isReverseTransition=!1;const r=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&("object"==typeof arguments[0][t]&&"object"==typeof arguments[e][t]?r(arguments[0][t],arguments[e][t]):arguments[0][t]=arguments[e][t]);return arguments[0]};(e=r({content:[],startScreen:{startScreenTitle:"",startScreenSubtitle:""},endScreens:[{endScreenTitle:"",endScreenSubtitle:"",contentId:-1}],scoringOptionGroup:{scoringOption:"no-score"},l10n:{},behaviour:"individual"},e.branchingPython)).l10n=r({startScreenButtonText:"Start the course",endScreenButtonText:"Restart the course",proceedButtonText:"Proceed",scoreText:"Your score:",backButtonText:"Back",fullscreenAria:"Fullscreen",replayButtonText:"Replay the video",disableProceedButtonText:"Require to complete the current module"},e.l10n),e.content.forEach(((t,n)=>{t.contentId=n,void 0===t.nextContentId&&(t.nextContentId=-1),e.behaviour.randomizeBranchingQuestions&&-1!==t.type.library.indexOf("H5P.BranchingQuestion")&&(t.type.params.branchingQuestion.randomize=!0),void 0===t.proceedButtonText&&(t.proceedButtonText=e.l10n.proceedButtonText)})),n.backwardsAllowedFlags=e.content.map((t=>"useBehavioural"===t.contentBehaviour?e.behaviour.enableBackwardsNavigation:"enabled"===t.contentBehaviour)),n.params=e,n.scoring=new H5P.BranchingPython.Scoring(e);const i=function(t){const r=new H5P.BranchingPython.GenericScreen(n,{isStartScreen:!1,titleText:t.endScreenTitle,subtitleText:t.endScreenSubtitle,image:t.endScreenImage,buttonText:e.l10n.endScreenButtonText,fullscreenAria:e.l10n.fullscreenAria,isCurrentScreen:!1,scoreText:e.l10n.scoreText,score:n.scoring.getScore(t.endScreenScore),maxScore:n.scoring.getMaxScore(),showScore:n.scoring.shouldShowScore()});return r.on("toggleFullScreen",(()=>{n.toggleFullScreen()})),r};n.getLibrary=function(t){return void 0!==e.content[t]&&e.content[t]},n.on("exitFullScreen",(function(){setTimeout((()=>{n.trigger("resize")}),100)})),n.on("started",(function(){const e=this.params.content[0];!1===n.canEnableBackButton(0)?n.disableBackButton():n.enableBackButton(),e&&e.type&&e.type.library&&"H5P.BranchingQuestion"===e.type.library.split(" ")[0]?n.trigger("navigated",{nextContentId:0}):(n.startScreen.hide(),n.libraryScreen.show(),n.triggerXAPI("progressed"),n.userPath.push(0)),n.currentId=0})),n.on("navigated",(function(t){t.data.reverse&&(n.libraryScreen&&n.libraryScreen.wrapper&&(n.libraryScreen.wrapper.style.height=""),n.userPath.pop(),t.data.nextContentId=n.userPath.pop()||0);const r=parseInt(t.data.nextContentId);n.userPath.push(r),n.currentId>-1&&H5P.BranchingPython.LibraryScreen.isBranching(n.getLibrary(n.currentId))&&n.$container.find('.h5p-back-button[isBQ="true"]').length&&n.$container.find('.h5p-back-button[isBQ="true"]').remove();const a=n.getLibrary(r);let s=!0;if(n.libraryScreen){if(n.libraryScreen.stopPlayback(n.currentId),!this.params.preventXAPI){const e=n.libraryScreen.getXAPIData(n.currentId),t=H5P.BranchingPython.LibraryScreen.isBranching(n.getLibrary(n.currentId)),r=t&&e.statement&&e.statement.result&&void 0!==e.statement.result.response;!e||t&&!r||n.xAPIDataCollector.push(e)}}else n.libraryScreen=new H5P.BranchingPython.LibraryScreen(n,e.startScreen.startScreenTitle,a),n.libraryScreen.on("toggleFullScreen",(()=>{n.toggleFullScreen()})),n.$container.append(n.libraryScreen.getElement()),n.currentId=r;if(H5P.BranchingPython.LibraryScreen.isBranching(n.getLibrary(n.currentId))&&document.querySelector(".h5p-current-screen").setAttribute("aria-hidden",!0),n.currentEndScreen&&n.currentEndScreen.isShowing?a?H5P.BranchingPython.LibraryScreen.isBranching(a)||(n.currentEndScreen.hide(),n.currentEndScreen=null,n.libraryScreen.show()):(n.libraryScreen.hideFeedbackDialogs(),n.currentEndScreen.hide(),n.currentEndScreen=null):n.startScreen&&n.startScreen.isShowing&&a?H5P.BranchingPython.LibraryScreen.isBranching(a)||(n.startScreen.hide(),n.libraryScreen.show(),s=!1):n.libraryScreen.hideFeedbackDialogs(),s&&n.trigger("resize"),-1!==n.currentId){n.triggerXAPI("progressed");let e={};n.libraryScreen.currentLibraryInstance&&n.libraryScreen.currentLibraryInstance.getScore&&(e={score:n.libraryScreen.currentLibraryInstance.getScore(),maxScore:n.libraryScreen.currentLibraryInstance.getMaxScore()}),n.scoring.addLibraryScore(this.currentId,this.libraryScreen.currentLibraryId,t.data.chosenAlternative,e)}if(!1===a){if(n.currentEndScreen=n.endScreens[r],t.data.feedback){const e=i({endScreenTitle:t.data.feedback.title||"",endScreenSubtitle:t.data.feedback.subtitle||"",endScreenImage:t.data.feedback.image,endScreenScore:t.data.feedback.endScreenScore});n.$container.append(e.getElement()),n.currentEndScreen=e}else n.scoring.isDynamicScoring()&&(n.currentEndScreen.setScore(n.getScore()),n.currentEndScreen.setMaxScore(n.getMaxScore()));n.startScreen.hide(),n.libraryScreen.hide(!0),n.currentEndScreen.show(),n.triggerXAPICompleted(n.scoring.getScore(n.currentEndScreen.getScore()),n.scoring.getMaxScore())}else n.libraryScreen.showNextLibrary(a,t.data.reverse),!1===n.canEnableBackButton(r)?n.disableBackButton():n.enableBackButton(),n.currentId=r;if(0!==t.data.nextContentId&&document.querySelector(".h5p-start-screen").classList.contains("h5p-current-screen")){const e=n.libraryScreen.wrapper.querySelector(".h5p-slide-in");e&&(e.classList.remove("h5p-next"),n.startScreen.hide(),n.libraryScreen.show())}})),n.on("restarted",(function(){n.currentEndScreen&&(n.currentEndScreen.hide(),n.currentEndScreen=null),n.scoring.restart(),n.xAPIDataCollector=[],n.startScreen.screenWrapper.style.height="",n.startScreen.screenWrapper.classList.remove("h5p-slide-out"),n.startScreen.show(n.isReverseTransition),n.isReverseTransition=!1,n.currentId=-1,n.userPath=[],n.libraryScreen&&n.libraryScreen.remove(),n.libraryScreen=new H5P.BranchingPython.LibraryScreen(n,e.startScreen.startScreenTitle,n.getLibrary(0)),n.libraryScreen.on("toggleFullScreen",(()=>{n.toggleFullScreen()})),n.$container.append(n.libraryScreen.getElement())})),n.on("resize",(function(e){if(n.bubblingUpwards)return;n.changeLayoutToFitWidth(),n.libraryScreen&&"object"==typeof n.libraryScreen&&0!==Object.keys(n.libraryScreen).length&&n.libraryScreen.resize(e);const t=n.$container[0].getBoundingClientRect();t.width<=480?n.$container.addClass("h5p-phone-size"):n.$container.removeClass("h5p-phone-size"),t.width<768?n.$container.addClass("h5p-medium-tablet-size"):n.$container.removeClass("h5p-medium-tablet-size")})),n.toggleFullScreen=function(){n.isFullScreen()?H5P.exitFullScreen&&H5P.exitFullScreen():H5P.fullScreen(n.$container,this)},n.isFullScreen=function(){return H5P.isFullscreen||n.$container&&n.$container[0].classList.contains("h5p-fullscreen")||n.$container&&n.$container[0].classList.contains("h5p-semi-fullscreen")},n.disableNavButton=function(){n.libraryScreen.navButton&&(n.libraryScreen.navButton.classList.add("h5p-disabled"),n.libraryScreen.navButton.setAttribute("disabled",!0),n.libraryScreen.navButton.setAttribute("title",e.l10n.disableProceedButtonText))},n.enableNavButton=function(e=!1){n.libraryScreen.navButton&&(n.libraryScreen.navButton.classList.remove("h5p-disabled"),n.libraryScreen.navButton.removeAttribute("disabled"),n.libraryScreen.navButton.removeAttribute("title"),e&&n.animateNavButton())},n.hideNavButton=function(){n.libraryScreen.navButton&&n.libraryScreen.navButton.classList.add("h5p-hidden")},n.showNavButton=function(e=!1){n.libraryScreen.navButton&&(n.libraryScreen.navButton.classList.remove("h5p-hidden"),document.activeElement.blur(),e&&n.animateNavButton(),setTimeout((()=>{n.libraryScreen.navButton.focus()}),100))},n.animateNavButton=function(){n.libraryScreen.navButton.classList.contains("h5p-animate")||n.libraryScreen.navButton.classList.add("h5p-animate")},n.unanimateNavButton=function(){n.libraryScreen.navButton.classList.remove("h5p-animate")},n.getScore=function(){return n.scoring.getScore()},n.getMaxScore=function(){return n.scoring.getMaxScore()},n.changeLayoutToFitWidth=function(){const e=parseInt(window.getComputedStyle(document.getElementsByTagName("body")[0]).fontSize,10);this.$container.width()/e>43?n.$container[0].classList.add("h5p-wide-screen"):n.$container[0].classList.add("h5p-mobile-screen")},n.disableBackButton=function(){n.libraryScreen&&n.libraryScreen.backButton&&(n.libraryScreen.backButton.classList.add("h5p-disabled"),n.libraryScreen.backButton.setAttribute("disabled",!0))},n.enableBackButton=function(){n.libraryScreen&&n.libraryScreen.backButton&&(n.libraryScreen.backButton.classList.remove("h5p-disabled"),n.libraryScreen.backButton.removeAttribute("disabled"))},n.getUserPath=function(){return n.userPath},n.canEnableBackButton=function(e){return"number"==typeof e&&!(e<0||e>n.backwardsAllowedFlags.length-1)&&n.backwardsAllowedFlags[e]},n.attach=function(t){if(void 0!==this.isRoot&&this.isRoot()&&this.setActivityStarted(),n.$container=t,t.addClass("h5p-branching-python").html(""),!e.content||0===e.content.length){const e=document.createElement("div");return e.innerHTML="No content",void n.$container.append(e)}n.startScreen=function({startScreenTitle:t,startScreenSubtitle:r,startScreenImage:i,startScreenAltText:a},s){const o=new H5P.BranchingPython.GenericScreen(n,{isStartScreen:!0,titleText:t,subtitleText:r,image:i,altText:a,fullscreenAria:e.l10n.fullscreenAria,buttonText:e.l10n.startScreenButtonText,isCurrentScreen:s});return o.on("toggleFullScreen",(()=>{n.toggleFullScreen()})),o}(e.startScreen,!0),n.$container.append(n.startScreen.getElement()),n.currentId=-1,n.libraryScreen=new H5P.BranchingPython.LibraryScreen(n,e.startScreen.startScreenTitle,n.getLibrary(0)),n.libraryScreen.on("toggleFullScreen",(()=>{n.toggleFullScreen()})),n.$container.append(n.libraryScreen.getElement()),e.endScreens.forEach((e=>{n.endScreens[e.contentId]=i(e),n.$container.append(n.endScreens[e.contentId].getElement())}))},n.getXAPIData=function(){if(!n.currentEndScreen)return void console.error("Called getXAPIData before finished.");const e=n.createXAPIEventTemplate("answered"),t=e.getVerifiedStatementValue(["object","definition"]);H5P.jQuery.extend(t,{interactionType:"compound",type:"http://adlnet.gov/expapi/activities/cmi.interaction"}),t.extensions={"https://h5p.org/x-api/no-question-score":1};const r=n.scoring.getScore(n.currentEndScreen.getScore()),i=n.scoring.getMaxScore();return e.setScoredResult(r,i,this,!0,r===i),{statement:e.data.statement,children:n.xAPIDataCollector}}},H5P.BranchingPython.prototype=Object.create(H5P.EventDispatcher.prototype),H5P.BranchingPython.prototype.constructor=H5P.BranchingPython,H5P.BranchingPython.GenericScreen=function(){function e(e,t){H5P.EventDispatcher.call(this);const n=this;n.parent=e,n.isShowing=t.isStartScreen,n.isFeedbackAvailable=!1,n.screenWrapper=document.createElement("div"),n.screenWrapper.classList.add(t.isStartScreen?"h5p-start-screen":"h5p-end-screen"),n.screenWrapper.classList.add(t.isCurrentScreen?"h5p-current-screen":"h5p-next-screen"),t.isCurrentScreen?n.parent.currentHeight="45em":this.screenWrapper.classList.add("h5p-branching-hidden");const r=document.createElement("div");r.classList.add("h5p-branching-python-screen-content");var i=document.createElement("div");i.classList.add("h5p-feedback-content-content"),r.appendChild(i),n.feedbackText=i;const a=document.createElement("h1");a.className="h5p-branching-python-title-text",a.innerHTML=t.titleText;const s=document.createElement("div");s.className="h5p-branching-python-subtitle-text",s.innerHTML=t.subtitleText;const o=document.createElement("button");o.classList.add(t.isStartScreen?"h5p-start-button":"h5p-end-button"),o.classList.add("transition"),o.onclick=function(){t.isStartScreen?n.parent.trigger("started"):n.parent.trigger("restarted");let e=document.getElementsByClassName("h5p-start-screen")[0];t.isStartScreen||(e.style.height=""),n.parent.navigating=!0},n.navButton=o;const c=document.createTextNode(t.buttonText);if(o.appendChild(c),i.appendChild(a),i.appendChild(s),r.appendChild(o),t.showScore&&void 0!==t.score&&(n.scoreWrapper=this.createResultContainer(t.scoreText,t.score,t.maxScore),r.insertBefore(n.scoreWrapper,r.firstChild)),H5P.canHasFullScreen){const e=document.createElement("button");e.className="h5p-branching-full-screen",e.setAttribute("aria-label",this.parent.params.l10n.fullscreenAria),e.addEventListener("click",(()=>{this.trigger("toggleFullScreen")})),n.screenWrapper.appendChild(e)}n.screenWrapper.appendChild(n.createScreenBackground(t.isStartScreen,t.image,t.altText)),n.screenWrapper.appendChild(r),(t.showScore&&void 0!==t.score||""!==t.titleText||""!==t.subtitleText)&&(i.tabIndex=-1,n.isFeedbackAvailable=!0),n.getScore=function(){return t.score},n.getMaxScore=function(){return t.maxScore},n.checkIntroReset=function(){let e=document.getElementsByClassName("h5p-start-screen")[0];["h5p-end-screen","h5p-current-screen"].every((e=>n.screenWrapper.classList.contains(e)))?e.classList.add("h5p-reset-start"):e.classList.contains("h5p-reset-start")&&e.classList.remove("h5p-reset-start")}}return e.prototype.getElement=function(){return this.screenWrapper},e.prototype.setScore=function(e){this.scoreValue&&void 0!==e&&(this.scoreValue.textContent=e.toString())},e.prototype.setMaxScore=function(e){void 0!==e&&(this.maxScoreValue.textContent=e.toString())},e.prototype.createResultContainer=function(e,t,n){const r=document.createElement("div");r.classList.add("h5p-result-wrapper");const i=document.createElement("div");i.classList.add("h5p-result-container");const a=document.createElement("div");a.classList.add("h5p-score-text"),a.appendChild(document.createTextNode(e));const s=document.createElement("div");s.classList.add("h5p-score-circle");const o=document.createElement("span");o.className="h5p-score-value",this.scoreValue=document.createTextNode(t.toString()),o.appendChild(this.scoreValue),s.appendChild(o);const c=document.createElement("span");c.className="h5p-score-delimiter",c.textContent="/",s.appendChild(c);const d=document.createElement("span");return d.className="h5p-max-score",this.maxScoreValue=document.createTextNode(n.toString()),d.appendChild(this.maxScoreValue),s.appendChild(d),i.appendChild(a),i.appendChild(s),r.appendChild(i),r},e.prototype.createScreenBackground=function(e,t,n){const r=document.createElement("div");r.classList.add("h5p-screen-background");const i=document.createElement("div");i.classList.add("h5p-screen-banner");const a=document.createElement("img");return a.classList.add("h5p-background-image"),t&&t.path?a.src=H5P.getPath(t.path,this.parent.contentId):a.src=e?this.parent.getLibraryFilePath("assets/start-screen-default.jpg"):this.parent.getLibraryFilePath("assets/end-screen-default.jpg"),n&&n.length&&a.setAttribute("aria-label",n),a.addEventListener("load",(()=>{this.parent.trigger("resize")})),r.appendChild(i),r.appendChild(a),r},e.prototype.show=function(e=!1){const t=this;t.isShowing=!0,e&&t.screenWrapper.classList.add("h5p-previous"),t.screenWrapper.classList.add("h5p-slide-in"),t.screenWrapper.classList.remove("h5p-branching-hidden"),t.screenWrapper.addEventListener("animationend",(function(n){"slide-in"===n.animationName&&(e&&t.screenWrapper.classList.remove("h5p-previous"),t.screenWrapper.classList.remove("h5p-next-screen"),t.screenWrapper.classList.remove("h5p-slide-in"),t.screenWrapper.classList.add("h5p-current-screen"),t.screenWrapper.setAttribute("aria-hidden",!1),t.parent.trigger("resize"),t.isFeedbackAvailable?t.feedbackText.focus():t.navButton.focus(),t.checkIntroReset())}))},e.prototype.hide=function(){const e=this;e.isShowing=!1,e.screenWrapper.classList.add("h5p-slide-out"),e.screenWrapper.addEventListener("animationend",(function(t){"slide-out"===t.animationName&&(e.screenWrapper.classList.add("h5p-branching-hidden"),e.screenWrapper.classList.remove("h5p-current-screen"),e.screenWrapper.classList.add("h5p-next-screen"),e.screenWrapper.classList.remove("h5p-slide-out"))}))},e}(),(()=>{"use strict";var e=n(734);H5P.BranchingPython.LibraryScreen=function(t){function n(e,t,n){H5P.EventDispatcher.call(this),this.parent=e,this.currentLibraryElement,this.currentLibraryInstance,this.currentLibraryId=0,this.nextLibraryId=n.nextContentId,this.libraryFeedback=n.feedback,this.nextLibraries={},this.libraryInstances={},this.libraryFinishingRequirements=[],this.libraryTitle,this.branchingQuestions=[],this.navButton,this.header,this.isShowing=!1,this.contentOverlays=[];const r=n.type&&n.type.metadata&&n.type.metadata.title?n.type.metadata.title:"";this.wrapper=this.createWrapper(t,r||"Untitled Content",n.showContentTitle&&r),this.wrapper.classList.add("h5p-next-screen"),this.wrapper.classList.add("h5p-branching-hidden");const i=this.createLibraryElement(n,!1);this.currentLibraryWrapper=i,this.currentLibraryElement=i.getElementsByClassName("h5p-branching-python-content")[0],this.currentLibraryInstance=this.libraryInstances[0],this.createNextLibraries(n),this.wrapper.appendChild(i),this.createNavButtons(),e.on("enterFullScreen",(()=>{setTimeout((()=>{this.currentLibraryInstance&&this.currentLibraryInstance.trigger("resize")}),500)}))}return n.prototype.handleLibraryResize=function(){if(this.parent.isFullScreen())return this.currentLibraryWrapper.style.height="",void(this.wrapper.style.minHeight="");this.currentLibraryWrapper.style.height=this.currentLibraryElement.clientHeight+40+"px",this.wrapper.style.minHeight=this.currentLibraryElement.clientHeight+40+70.17+"px",this.currentLibraryWrapper.offsetHeight<this.currentLibraryElement.scrollHeight&&(this.currentLibraryElement.tabIndex=0)},n.prototype.createWrapper=function(t,n,r){const i=this,a=this.parent,s=document.createElement("div"),o=document.createElement("div");if(o.classList.add("h5p-title-wrapper"),H5P.canHasFullScreen){const e=document.createElement("button");e.className="h5p-branching-full-screen",e.setAttribute("aria-label",this.parent.params.l10n.fullscreenAria),e.addEventListener("click",(()=>{this.trigger("toggleFullScreen")})),o.appendChild(e)}const c=document.createElement("div");c.className="h5p-branching-header";const d=document.createElement("h1");d.innerHTML=t,c.appendChild(d);const l=document.createElement("h2");l.classList.add("library-subtitle"),l.innerHTML=r?n:"&nbsp;",l.setAttribute("tabindex","-1"),l.setAttribute("aria-label",n),c.appendChild(l),o.appendChild(c),this.libraryTitle=l;const h=document.createElement("div");return h.classList.add("h5p-screen-header"),this.header=h,h.appendChild(o),s.appendChild(h),(0,e.kp)(s,(()=>{this.wrapper.clientHeight>500&&(this.wrapper.style.minHeight=this.wrapper.clientHeight+"px")})),s.addEventListener("animationend",(function(t){"slide-in"===t.animationName&&i.currentLibraryElement&&(a.trigger("resize"),setTimeout((()=>{(0,e.kp)(i.currentLibraryElement,(()=>{i.handleLibraryResize(),a.trigger("resize")}))}),100))})),s},n.prototype.createBackButton=function(e){const t=this,n=document.createElement("button");return n.classList.add("transition"),n.classList.add("h5p-back-button"),n.addEventListener("click",(e=>{if(e.currentTarget.hasAttribute("isBQ"))return this.overlay&&(null!==this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=void 0,this.branchingQuestions.forEach((e=>{null!==e.parentNode&&e.parentNode.removeChild(e)})),this.showBackgroundToReadspeaker()),"H5P.BranchingQuestion"===t.parent.params.content[0].type.library.split(" ")[0]&&0===t.parent.currentId?(t.parent.trigger("restarted"),n):void t.parent.trigger("navigated",{reverse:!0});if(!0!==t.parent.navigating){if(0===t.currentLibraryId&&"H5P.BranchingQuestion"!==t.parent.params.content[t.parent.currentId].type.library.split(" ")[0])return t.parent.isReverseTransition=!0,t.parent.trigger("restarted"),n;t.parent.trigger("navigated",{reverse:!0}),t.parent.navigating=!0}})),n.appendChild(document.createTextNode(e)),n},n.prototype.handleProceed=function(){let e=!0;if(!1===this.parent.navigating){const t=this.libraryFeedback.title&&this.libraryFeedback.title.trim(),n=this.libraryFeedback.subtitle&&this.libraryFeedback.subtitle.trim(),r=!!(t||n||this.libraryFeedback.image);if(r&&-1!==this.nextLibraryId){void 0===this.overlay&&(this.overlay=document.createElement("div"),this.overlay.className="h5p-branching-python-overlay",this.wrapper.appendChild(this.overlay),this.hideBackgroundFromReadspeaker());const e=document.createElement("div");e.classList.add("h5p-branching-question-wrapper"),e.classList.add("h5p-branching-python-feedback-dialog");const t=document.createElement("div");t.classList.add("h5p-branching-question-container"),e.appendChild(t);const n=this.createFeedbackScreen(this.libraryFeedback,this.nextLibraryId);t.appendChild(n),t.classList.add("h5p-start-outside"),t.classList.add("h5p-fly-in"),this.currentLibraryWrapper.style.zIndex=0,setTimeout((()=>{this.wrapper.appendChild(e),parseInt(this.currentLibraryWrapper.style.height)<t.offsetHeight&&(this.currentLibraryElement.style.height=t.offsetHeight+"px",this.wrapper.style.height=t.offsetHeight+"px",this.parent.trigger("resize"))}),100),n.focus(),this.parent.navigating=!0}else{const t={nextContentId:this.nextLibraryId};(r||void 0!==this.libraryFeedback.endScreenScore)&&(t.feedback=this.libraryFeedback);const n=this;e=!1,new Promise((e=>{e(n.parent.trigger("navigated",t))})).then((()=>{this.parent.proceedButtonInProgress=!1,this.parent.navigating=!0}))}}if(e)return e},n.prototype.createFeedbackScreen=function(e,t){const r=this,i="h5p-branching-feedback-title-"+n.idCounter++;var a=document.createElement("div");if(a.classList.add("h5p-branching-question"),a.classList.add(void 0!==e.image?"h5p-feedback-has-image":"h5p-feedback-default"),a.setAttribute("role","dialog"),a.setAttribute("tabindex","-1"),a.setAttribute("aria-labelledby",i),void 0!==e.image&&void 0!==e.image.path){var s=document.createElement("div");s.classList.add("h5p-branching-question"),s.classList.add("h5p-feedback-image");var o=document.createElement("img");o.src=H5P.getPath(e.image.path,r.parent.contentId),s.appendChild(o),a.appendChild(s)}var c=document.createElement("div");c.classList.add("h5p-branching-question"),c.classList.add("h5p-feedback-content");var d=document.createElement("div");d.classList.add("h5p-feedback-content-content"),c.appendChild(d);var l=document.createElement("h1");if(l.id=i,l.innerHTML=e.title||"",d.appendChild(l),e.subtitle){var h=document.createElement("div");h.innerHTML=e.subtitle||"",d.appendChild(h)}var p=document.createElement("button");p.onclick=function(){r.parent.trigger("navigated",{nextContentId:t})};const u=r.parent.getLibrary(r.currentLibraryId).proceedButtonText;var b=document.createTextNode(u);return p.appendChild(b),c.appendChild(p),a.appendChild(c),a},n.prototype.createLibraryElement=function(e,t){const n=document.createElement("div");n.classList.add("h5p-library-wrapper");const r=document.createElement("div");r.classList.add("h5p-branching-python-content"),this.appendRunnable(r,e.type,e.contentId);const i=e.type&&e.type.library.split(" ")[0];return this.contentOverlays[e.contentId]=new H5P.BranchingPython.LibraryScreenOverlay(this),n.appendChild(this.contentOverlays[e.contentId].getDOM()),"H5P.InteractiveVideo"!==i&&"H5P.Video"!==i||(this.contentOverlays[e.contentId].addButton("replay",this.parent.params.l10n.replayButtonText,(()=>{this.handleReplayVideo(i,e)})),this.contentOverlays[e.contentId].addButton("proceed",e.proceedButtonText,(()=>{this.handleProceedAfterVideo()}))),n.appendChild(r),t&&(n.classList.add("h5p-next"),r.classList.add("h5p-branching-hidden")),"H5P.BranchingQuestion"===i&&r.classList.add("h5p-branching-hidden"),n},n.prototype.handleReplayVideo=function(e,t){this.contentOverlays[this.currentLibraryId].hide(),!0===this.libraryFinishingRequirements[t.contentId]&&this.hasValidVideo(t)&&this.parent.disableNavButton(),this.currentLibraryInstance.currentState=3,this.currentLibraryInstance.seek(0),this.currentLibraryInstance.play(),"H5P.InteractiveVideo"===e&&this.resetIVProgress()},n.prototype.resetIVProgress=function(){this.currentLibraryInstance.interactions.forEach((function(e){e.resetTask()}));let e=this.currentLibraryInstance;e.addSliderInteractions(),e.endscreen&&(e.endscreen.update(),e.endscreen.$closeButton[0].click(),this.wrapper.getElementsByClassName("h5p-star-foreground")[0].classList.remove("h5p-star-active"))},n.prototype.handleProceedAfterVideo=function(){this.contentOverlays[this.currentLibraryId].hide(),this.handleProceed()},n.prototype.appendRunnable=function(e,t,n){const r=this,i=this.parent,a=t.library.split(" ")[0];if("H5P.Video"===a)t.params.visuals.fit=!1;else if("H5P.BranchingQuestion"===a){const e=i.getLibrary(n).proceedButtonText;t.params.proceedButtonText=e}const s=H5P.jQuery.extend(!0,{},t),o=H5P.newRunnable(s,this.parent.contentId,H5P.jQuery(e),!0,{parent:this.parent});if(("enabled"===this.parent.params.content[n].forceContentFinished||"useBehavioural"===this.parent.params.content[n].forceContentFinished&&!0===this.parent.params.behaviour.forceContentFinished)&&(this.libraryFinishingRequirements[n]=this.forceContentFinished(o,a),this.addFinishedListeners(o,a)),o.setActivityStarted(),"H5P.Video"===a&&this.nextIsBranching(n)?o.on("stateChange",(function(e){e.data===H5P.Video.ENDED&&r.navButton&&r.handleProceed()})):"H5P.Image"===a&&o.on("loaded",(function(){r.handleLibraryResize(),r.parent.trigger("resize")})),"H5P.Video"===a||"H5P.InteractiveVideo"===a){const e="H5P.Video"===a?o:o.video;e.on("loaded",(()=>{r.handleLibraryResize()})),e.on("error",(()=>{r.parent.enableNavButton()}))}o.on("navigated",(function(e){i.trigger("navigated",e.data)})),this.libraryInstances[n]=o,this.bubbleUp(o,"resize",i),this.disableFullscreen(o)},n.prototype.stopPlayback=function(e){const t=this.libraryInstances[e];if(t)try{if(void 0!==t.pause&&(t.pause instanceof Function||"function"==typeof t.pause))t.pause();else if(void 0!==t.video&&void 0!==t.video.pause&&(t.video.pause instanceof Function||"function"==typeof t.video.pause))t.video.pause();else if(void 0!==t.stop&&(t.stop instanceof Function||"function"==typeof t.stop))t.stop();else if(void 0!==t.pauseMedia&&(t.pauseMedia instanceof Function||"function"==typeof t.pauseMedia)&&t.elementInstances[t.currentSlideIndex])for(let e=0;e<t.elementInstances[t.currentSlideIndex].length;e++)t.pauseMedia(t.elementInstances[t.currentSlideIndex][e])}catch(e){H5P.error(e)}},n.prototype.forceContentFinished=function(e,t){let n=!1;return e&&(n=n||e.getScore&&"function"==typeof e.getScore),t&&(n=n||"H5P.Audio"===t||"H5P.Video"===t),("H5P.CoursePresentation"===t&&e&&e.children.length+(e.isTask?1:0)===1||!0===e.activeSurface)&&(n=!1),n},n.prototype.addFinishedListeners=function(e,t){const n=this;if("string"==typeof t&&e)switch(t){case"H5P.CoursePresentation":e.on("xAPI",(t=>{"progressed"===t.data.statement.verb.display["en-US"]&&parseInt(t.data.statement.object.definition.extensions["http://id.tincanapi.com/extension/ending-point"])===e.children.length+(e.isTask?1:0)&&this.navButton.classList.contains("h5p-disabled")&&n.parent.enableNavButton(!0)}));break;case"H5P.InteractiveVideo":e.on("xAPI",(e=>{"completed"===e.data.statement.verb.display["en-US"]&&n.handleVideoOver()})),e.video.on("stateChange",(function(t){if(t.data===H5P.Video.ENDED||t.data===H5P.Video.PLAYING&&!1===n.contentOverlays[n.currentLibraryId].hidden){const t=e.interactions.filter((e=>void 0!==e.getProgress()));e.hasStar&&t.length>0?n.parent.enableNavButton():n.handleVideoOver(),this.pause()}}));break;case"H5P.Video":e.on("stateChange",(function(e){e.data===H5P.Video.ENDED&&(n.nextIsBranching(n.currentLibraryId)||n.handleVideoOver())}));break;case"H5P.Audio":e.audio.on("ended",(function(){n.parent.enableNavButton()}));break;default:"function"==typeof e.getAnswerGiven&&e.on("xAPI",(e=>{"answered"!==e.data.statement.verb.display["en-US"]&&"completed"!==e.data.statement.verb.display["en-US"]||n.parent.enableNavButton()}))}},n.prototype.handleVideoOver=function(){this.nextIsBranching(this.currentLibraryId)?this.handleProceed():this.showContentOverlay(),this.parent.enableNavButton()},n.prototype.showContentOverlay=function(){this.contentOverlays[this.currentLibraryId].show()},n.prototype.hideContentOverlay=function(){this.contentOverlays[this.currentLibraryId].hide()},n.prototype.getXAPIData=function(e){if(this.libraryInstances[e]&&this.libraryInstances[e].getXAPIData)return this.libraryInstances[e].getXAPIData()},n.prototype.nextIsBranching=function(e){const t=void 0!==e?this.parent.params.content[e].nextContentId:void 0;return void 0!==t&&t>0&&n.isBranching(this.parent.params.content[t])},n.prototype.createNextLibraries=function(e){this.removeNextLibraries(),this.nextLibraries={},this.loadLibrary(e)},n.prototype.createNextLibrary=function(e){this.removeNextLibraries(),this.nextLibraries={},this.loadLibrary(e,e.contentId)},n.prototype.loadLibrary=function(e,t=null){const n=null!==t?t:e.nextContentId;if("H5P.BranchingQuestion"!==e.type.library.split(" ")[0]){const e=this.parent.getLibrary(n);if(!1===e)return;e.type&&"H5P.BranchingQuestion"!==e.type.library.split(" ")[0]&&(this.nextLibraries[n]=this.createLibraryElement(e,!0),this.wrapper.appendChild(this.nextLibraries[n]))}else(e.type.params.branchingQuestion.alternatives||[]).map((e=>e.nextContentId)).forEach((e=>{const t=this.parent.getLibrary(e);!1!==t&&t.type&&"H5P.BranchingQuestion"!==t.type.library.split(" ")[0]&&(this.nextLibraries[e]=this.createLibraryElement(t,!0),this.wrapper.appendChild(this.nextLibraries[e]))}))},n.prototype.removeNextLibraries=function(){let e=this.wrapper.getElementsByClassName("h5p-next");for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])},n.prototype.disableFullscreen=function(e){switch(e.libraryInfo.machineName){case"H5P.CoursePresentation":e.$fullScreenButton&&e.$fullScreenButton.remove();break;case"H5P.InteractiveVideo":e.on("controls",(function(){e.controls.$fullscreen&&e.controls.$fullscreen.remove()}))}},n.prototype.bubbleUp=function(e,t,n){e.on(t,(function(e){n.bubblingUpwards=!0,n.trigger(t,e),n.bubblingUpwards=!1}))},n.prototype.hasValidVideo=function(e){const t=e.type,n=t.metadata.contentType;let r="Interactive Video"===n?t.params.interactiveVideo.video.files:t.params.sources;return!(!t||"Interactive Video"!==n&&"Video"!==n||!r||!r[0].mime||"video/unknown"===r[0].mime||!("video/webm"!==r[0].mime&&"video/mp4"!==r[0].mime||H5P.VideoHtml5.canPlay(r)))},n.prototype.show=function(){const e=this,t=e.parent.params.content[e.currentLibraryId];!0!==e.libraryFinishingRequirements[e.currentLibraryId]||!e.hasValidVideo(t)&&"H5P.CoursePresentation"!==t.type.library.split(" ")[0]||(e.contentOverlays[e.currentLibraryId].hide(),e.parent.disableNavButton()),e.isShowing=!0,e.wrapper.classList.add("h5p-slide-in"),e.wrapper.classList.remove("h5p-branching-hidden"),e.wrapper.addEventListener("animationend",(function(t){"h5p-next-screen h5p-slide-in"===t.target.className&&(e.wrapper.classList.remove("h5p-next-screen"),e.wrapper.classList.remove("h5p-slide-in"),e.wrapper.classList.add("h5p-current-screen"),e.parent.navigating=!1,e.wrapper.style.minHeight=e.parent.currentHeight,e.libraryTitle.focus())}))},n.prototype.hide=function(e){const t=this;t.isShowing=!1;for(let e=0;e<this.nextLibraries.length;e++)this.nextLibraries[e].style.display="none",null!==this.nextLibraries[e].parentNode&&this.nextLibraries[e].parentNode.removeChild(this.nextLibraries[e]);function n(){t.wrapper.classList.remove("h5p-current-screen"),t.wrapper.classList.add("h5p-next-screen"),t.wrapper.classList.remove("h5p-slide-out"),t.wrapper.classList.remove("h5p-slide-out-reverse"),t.wrapper.classList.remove("h5p-slide-pseudo"),setTimeout((()=>{null!==t.wrapper.parentNode&&(t.wrapper.parentNode.removeChild(t.wrapper),t.remove(),t.parent.libraryScreen=null,t.parent.trigger("resize"))}),100)}this.overlay&&(null!==this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=void 0,this.branchingQuestions.forEach((e=>{null!==e.parentNode&&e.parentNode.removeChild(e)}))),t.wrapper.classList.add("h5p-slide-out"),e?setTimeout((()=>{n()}),800):t.wrapper.addEventListener("animationend",n)},n.prototype.hideBranchingQuestion=function(e){this.nextLibraryId=e.nextContentId,this.libraryFeedback=e.feedback,null!==this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=void 0,this.branchingQuestions.forEach((e=>{null!==e.parentNode&&e.parentNode.removeChild(e)})),this.createNextLibraries(e),this.parent.navigating=!1,this.navButton.focus(),this.showBackgroundToReadspeaker()},n.prototype.hideFeedbackDialogs=function(){this.overlay&&(null!==this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=void 0,this.showBackgroundToReadspeaker());const e=document.querySelector(".h5p-current-screen");if(!e)return;const t=e.querySelector(".h5p-branching-question-wrapper");t&&t.parentNode.removeChild(t)},n.prototype.resizeScreen=function(e=!1){if(!this.questionContainer)return;let t=e?this.parent.startScreen.screenWrapper:this.wrapper;const n=parseInt(window.getComputedStyle(this.questionContainer,null).getPropertyValue("padding-top"),10);t.style.height=this.questionContainer.offsetHeight+n+"px"},n.prototype.showNextLibrary=function(e,t=!1){if(this.nextLibraryId=e.nextContentId,this.libraryFeedback=e.feedback,n.isBranching(e)){!0===this.parent.params.behaviour&&this.parent.disableNavButton(),this.branchingQuestions.forEach((e=>{null!==e.parentNode&&e.parentNode.removeChild(e)}));const t=document.querySelector(".h5p-current-screen");void 0===this.overlay&&(this.overlay=document.createElement("div"),this.overlay.className="h5p-branching-python-overlay",t.appendChild(this.overlay),this.hideBackgroundFromReadspeaker());const r=document.createElement("div");r.classList.add("h5p-nav-button-wrapper"),-1!==this.parent.backwardsAllowedFlags.indexOf(!0)&&(this.bqBackButton=this.createBackButton(this.parent.params.l10n.backButtonText),this.bqBackButton.setAttribute("isBQ",!0),!1===this.parent.canEnableBackButton(e.contentId)&&(this.bqBackButton.classList.add("h5p-disabled"),this.bqBackButton.setAttribute("disabled",!0)),r.appendChild(this.bqBackButton));const i=document.createElement("div");i.className="h5p-branching-question-wrapper",this.appendRunnable(i,e.type,e.contentId),t.appendChild(i),this.branchingQuestions.push(i);const a="h5p-branching-question-title-"+n.idCounter++,s=i.querySelector(".h5p-branching-question-container");this.questionContainer=s,s.setAttribute("role","dialog"),s.setAttribute("tabindex","-1"),s.setAttribute("aria-labelledby",a),s.classList.add("h5p-start-outside"),s.classList.add("h5p-fly-in"),i.querySelector(".h5p-branching-question-title").id=a;const o=i.querySelector(".h5p-multichoice-wrapper");o.setAttribute("role","group"),o.setAttribute("aria-labelledby",a),document.querySelector(".h5p-branching-question").appendChild(r),this.currentLibraryWrapper.style.zIndex=0;const c=this.parent.isFullScreen(),d=this.parent.$container[0].classList.contains("h5p-mobile-screen");""!==this.currentLibraryWrapper.style.height||this.parent.startScreen.isShowing||c||d?this.parent.startScreen.isShowing&&!c?this.resizeScreen(!0):parseInt(this.currentLibraryWrapper.style.height)<s.offsetHeight&&(this.currentLibraryWrapper.style.height=s.offsetHeight+"px"):this.resizeScreen(),this.createNextLibraries(e),this.parent.navigating=!1,i.addEventListener("animationend",(function(){void 0!==i.querySelectorAll(".h5p-branching-question-alternative")[0]&&s.focus()}))}else{let n=!0;!0!==this.libraryFinishingRequirements[e.contentId]||!this.hasValidVideo(e)&&"H5P.CoursePresentation"!==e.type.library.split(" ")[0]||(this.contentOverlays[this.currentLibraryId].hide(),this.parent.disableNavButton(),n=!1),document.querySelector(".h5p-proceed-button").innerHTML=e.proceedButtonText;const r=e.type&&e.type.metadata&&e.type.metadata.title?e.type.metadata.title:"";this.libraryTitle.setAttribute("aria-label",r||"Untitled Content"),this.libraryTitle.innerHTML=e.showContentTitle&&r?r:"&nbsp;",this.currentLibraryId===e.contentId?this.currentLibraryWrapper.classList.add("h5p-slide-pseudo"):t?this.currentLibraryWrapper.classList.add("h5p-slide-out-reverse"):this.currentLibraryWrapper.classList.add("h5p-slide-out"),this.overlay&&(null!==this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=void 0,this.branchingQuestions.forEach((e=>{null!==e.parentNode&&e.parentNode.removeChild(e)})),this.showBackgroundToReadspeaker()),this.nextLibraries[e.contentId]||this.createNextLibrary(e);const i=this.nextLibraries[e.contentId];if(!i.offsetParent){const e=document.querySelector(".h5p-screen-footer");this.wrapper.insertBefore(i,e)}t&&(i.classList.remove("h5p-next"),i.classList.add("h5p-previous")),i.classList.add("h5p-slide-in");const a=i.getElementsByClassName("h5p-branching-python-content")[0];a.classList.remove("h5p-branching-hidden"),this.currentLibraryId=e.contentId,this.currentLibraryInstance=this.libraryInstances[e.contentId],this.currentLibraryInstance.resize&&this.currentLibraryInstance.resize();const s=this;this.currentLibraryWrapper.addEventListener("animationend",(function(){null!==s.currentLibraryWrapper.parentNode&&s.currentLibraryWrapper.parentNode.removeChild(s.currentLibraryWrapper),s.currentLibraryWrapper=i,s.wrapper.setAttribute("aria-hidden",!1),s.currentLibraryWrapper.classList.remove("h5p-previous"),s.currentLibraryWrapper.classList.remove("h5p-next"),s.currentLibraryWrapper.classList.remove("h5p-slide-in"),s.currentLibraryElement=i.getElementsByClassName("h5p-branching-python-content")[0],s.createNextLibraries(e),s.parent.navigating=!1,s.libraryTitle.focus(),n&&s.parent.enableNavButton(),s.resize(new H5P.Event("resize",{element:a}))}))}},n.prototype.hideBackgroundFromReadspeaker=function(){const e=this;this.header.setAttribute("aria-hidden","true"),this.currentLibraryWrapper.setAttribute("aria-hidden","true");let t=document.querySelector(".h5p-container");(t||(t=document.querySelector(".preview-wrapper"),t))&&(this.tabbables=[],t.querySelectorAll("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, iframe, object, embed, *[tabindex], *[contenteditable], video, audio").forEach((function(t){if(t instanceof HTMLMediaElement)t.controls&&(t.controls=!1,e.tabbables.push({element:t}));else{const n=t.classList.contains("ui-slider-handle")?0:t.getAttribute("tabindex");t.setAttribute("tabindex","-1"),e.tabbables.push({element:t,tabindex:n})}})))},n.prototype.showBackgroundToReadspeaker=function(){this.header.setAttribute("aria-hidden","false"),this.currentLibraryWrapper.setAttribute("aria-hidden","false"),this.tabbables&&(this.tabbables.forEach((function(e){const t=e.element;t instanceof HTMLMediaElement?t.controls=!0:void 0!==e.tabindex&&null!==e.tabindex?t.setAttribute("tabindex",e.tabindex):t.removeAttribute("tabindex")})),this.tabbables=null)},n.prototype.getElement=function(){return this.wrapper},n.prototype.remove=function(){null!==this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)},n.prototype.resize=function(e){const t=this.currentLibraryInstance,n=e&&e.data&&e.data.element?e.data.element:this.currentLibraryElement,r=t&&"H5P.Image"===t.libraryInfo.machineName,i=t&&"H5P.CoursePresentation"===t.libraryInfo.machineName,a=t&&"H5P.ImageHotspots"===t.libraryInfo.machineName,s=t&&"H5P.Video"===t.libraryInfo.machineName,o=t&&"H5P.InteractiveVideo"===t.libraryInfo.machineName,c=t&&t.width&&t.height,d=n.classList.contains("h5p-youtube"),l=c&&(r||i)||a||s;if(l&&(n.style.width="",n.style.height="",a&&(n.style.maxWidth="")),this.parent.isFullScreen()){if(n.classList.add("h5p-fullscreen"),o&&t.$videoWrapper[0].firstChild.style&&(t.videoHeight=t.$videoWrapper[0].firstChild.style.height),l){const e=s&&void 0!==this.parent.params.content[this.currentLibraryId].type.params.sources?n.getBoundingClientRect():null;if(s&&void 0===this.parent.params.content[this.currentLibraryId].type.params.sources?n.classList.add("h5p-video-no-source"):n.classList.remove("h5p-video-no-source"),e||a||i||r){const r=a?t.options.image.height:s?e.height:t.height,c=a?t.options.image.width:i?t.ratio*r:s?e.width:t.width,l=r/c,h=o?n.lastChild:n,p=h.getBoundingClientRect();l>p.height/p.width?a?h.style.maxWidth=p.height*(c/r)+"px":h.style.width=p.height*(c/r)+"px":(h.style.height=p.width*l+"px",d&&null!==n.querySelector("iframe")&&(n.querySelector("iframe").style.height=p.width*l+"px"))}}}else{this.parent.startScreen.isShowing?this.resizeScreen(!0):this.overlay?this.resizeScreen():this.wrapper.style.height="";const e=n.getElementsByClassName("h5p-video-wrapper");if(o&&e.length>0){let n=e[0].firstChild;n.style&&(n.style.height=t.videoHeight)}else d&&null!==n.querySelector("iframe")&&(n.querySelector("iframe").style.height="");n.classList.remove("h5p-fullscreen")}t&&(t.trigger("resize",e),this.handleLibraryResize())},n.isBranching=function(e){return!!(e&&e.type&&e.type.library)&&0===e.type.library.indexOf("H5P.BranchingQuestion ")},n.prototype.createNavButtons=function(){const e=this,t=this.parent,n=document.createElement("div");n.classList.add("h5p-nav-button-wrapper"),-1!==t.backwardsAllowedFlags.indexOf(!0)&&(this.backButton=this.createBackButton(t.params.l10n.backButtonText),n.appendChild(this.backButton));const r=document.createElement("button");r.classList.add("transition"),r.onclick=function(){if(!1===t.navigating){const r=e.libraryFeedback.title&&e.libraryFeedback.title.trim(),i=e.libraryFeedback.subtitle&&e.libraryFeedback.subtitle.trim(),a=!!(r||i||e.libraryFeedback.image);if(a&&-1!==e.nextLibraryId){void 0===e.overlay&&(e.overlay=document.createElement("div"),e.overlay.className="h5p-branching-python-overlay",e.wrapper.appendChild(e.overlay),e.hideBackgroundFromReadspeaker());const t=document.createElement("div");t.classList.add("h5p-branching-question-wrapper"),t.classList.add("h5p-branching-python-feedback-dialog");var n=document.createElement("div");n.classList.add("h5p-branching-question-container"),t.appendChild(n);const r=e.createFeedbackScreen(e.libraryFeedback,e.nextLibraryId);n.appendChild(r),n.classList.add("h5p-start-outside"),n.classList.add("h5p-fly-in"),e.currentLibraryWrapper.style.zIndex=0,e.wrapper.appendChild(t),r.focus()}else{const n={nextContentId:e.nextLibraryId};(a||void 0!==e.libraryFeedback.endScreenScore)&&(n.feedback=e.libraryFeedback),t.trigger("navigated",n)}t.navigating=!0}},r.classList.add("h5p-nav-button"),this.navButton=document.createElement("button"),this.navButton.classList.add("transition"),this.navButton.addEventListener("animationend",(()=>{this.parent.unanimateNavButton()})),this.navButton.addEventListener("click",(()=>{if(this.parent.proceedButtonInProgress)return;this.parent.proceedButtonInProgress=!0;const e=this;new Promise((t=>{e.handleProceed()&&t(!0)})).then((()=>{e.parent.proceedButtonInProgress=!1}))})),this.navButton.classList.add("h5p-nav-button","h5p-proceed-button");const i=t.getLibrary(this.currentLibraryId).proceedButtonText;this.navButton.appendChild(document.createTextNode(i)),n.appendChild(this.navButton);const a=document.createElement("div");a.classList.add("h5p-screen-footer"),a.appendChild(n),e.wrapper.appendChild(a)},n.idCounter=0,n}(H5P.jQuery)})(),H5P.BranchingPython.LibraryScreenOverlay=function(){function e(e){this.hidden=!0,this.parent=e,this.overlay=document.createElement("div"),this.overlay.classList.add("h5p-content-overlay"),this.overlay.classList.add("h5p-hidden"),this.buttonsContainer=document.createElement("div"),this.buttonsContainer.classList.add("h5p-content-overlay-buttons-container"),this.overlay.appendChild(this.buttonsContainer),this.buttons={}}return e.prototype.getDOM=function(){return this.overlay},e.prototype.show=function(){this.overlay.classList.remove("h5p-hidden"),window.requestAnimationFrame((()=>{this.buttonsContainer.classList.remove("h5p-hidden"),this.hidden=!1,Object.values(this.buttons)[Object.keys(this.buttons).length-1].focus()}))},e.prototype.hide=function(){this.hidden=!0,this.overlay.classList.add("h5p-hidden"),this.buttonsContainer.classList.add("h5p-hidden")},e.prototype.isVisible=function(){return!this.hidden},e.prototype.addButton=function(e,t,n){if(!e&&0!==e||!t||"function"!=typeof n||this.buttons[e])return null;const r=document.createElement("button");return r.classList.add("transition"),r.classList.add("h5p-nav-button"),r.classList.add(`h5p-nav-button-${e}`),r.innerText=t,r.addEventListener("click",(t=>{n(e)})),this.buttons[e]=r,this.buttonsContainer.appendChild(r),r},e.prototype.removeButton=function(e){(e||0===e)&&this.buttons[e]&&(this.buttonsContainer.removeChild(this.buttons[e]),delete this.buttons[e])},e}(),H5P.BranchingPython.Scoring=function(){const e="static-end-score",t="dynamic-score";return function(n){const r=this;let i=[],a=0;const s=function(e){return e&&e.feedback&&void 0!==e.feedback.endScreenScore};this.getScore=function(r){return n.scoringOptionGroup.scoringOption===t?i.reduce((function(e,t){return e+t.score}),0):n.scoringOptionGroup.scoringOption===e?r:0},this.getMaxScore=function(){return n.scoringOptionGroup.scoringOption===e?function(){const e=n.endScreens[0].endScreenScore,t=void 0!==e?e:0;return n.content.reduce((function(e,t){let n=[t];return r.isBranchingQuestion(t)&&(n=t.type.params.branchingQuestion.alternatives),e.concat(n)}),[]).filter((function(e){return-1===e.nextContentId})).reduce((function(e,n){let r=s(n)?n.feedback.endScreenScore:t;return e>=r?e:r}),0)}():n.scoringOptionGroup.scoringOption===t?function(){let e=0;return i.forEach((function(t){e+=t.maxScore})),e}():0},this.restart=function(){i=[],a=0},this.addLibraryScore=function(e,t,r,o){a+=1;const c=n.content[e];let d=0,l=0;e!==t||0===e&&this.isBranchingQuestion(c)?(d=function(e,t){if(!(t>=0))return 0;if(!(e&&e.type&&e.type.params&&e.type.params.branchingQuestion&&e.type.params.branchingQuestion.alternatives&&e.type.params.branchingQuestion.alternatives[t]))return 0;const n=e.type.params.branchingQuestion.alternatives[t];return!s(n)||void 0===n.nextContentId||n.nextContentId<0?0:n.feedback.endScreenScore}(c,r),l=function(e,t){if(!(t>=0))return 0;const n=e.type.params.branchingQuestion.alternatives;let r=0;return n.forEach((function(e,t){n[t].feedback.endScreenScore>r&&-1!==n[t].nextContentId&&(r=n[t].feedback.endScreenScore)})),r}(c,r)):(s(c)&&c.nextContentId&&c.nextContentId>-1&&(d=c.feedback.endScreenScore,l=c.feedback.endScreenScore),n.scoringOptionGroup.includeInteractionsScores&&0!==Object.entries(o).length&&(d+=o.score,l+=o.maxScore));let h=!1,p=null,u=-1;i.forEach((function(t,r){t.id===e&&(t.score=d,t.visitedIndex=a,u=t.visitedIndex,i.length>r+1&&n.content[t.id].nextContentId===i[r+1].id?h=!0:p=r)})),h?(i=i.filter((function(e){return e.visitedIndex<=u})),a=u):(null!==p&&i.splice(p,1),i.push({visitedIndex:a,id:e,score:d,maxScore:l}))},this.isBranchingQuestion=function(e){let t=e;return e&&e.type&&e.type.library&&(t=e.type.library),"H5P.BranchingQuestion"===t.split(" ")[0]},this.isDynamicScoring=function(){return n.scoringOptionGroup.scoringOption===t},this.shouldShowScore=function(){return n.scoringOptionGroup.scoringOption===e||this.isDynamicScoring()}}}()})();